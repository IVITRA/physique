<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø®ØªØ¨Ø± Ø§Ù„ØªØ­Ø¯ÙŠ Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¦ÙŠ</title>
    <style>
        /* --- Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© --- */
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap');
        
        body {
            font-family: 'Cairo', sans-serif;
            background-color: #111;
            color: #eee;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
            user-select: none;
        }

        /* --- Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© --- */
        #game-container {
            width: 800px;
            height: 600px;
            border: 2px solid #00bfff;
            position: relative;
            background-color: #000;
            overflow: hidden;
            box-shadow: 0 0 30px rgba(0, 191, 255, 0.6), inset 0 0 20px rgba(0, 191, 255, 0.2);
            border-radius: 15px;
            cursor: none;
        }

        /* --- Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„Ù…Ø®ØªÙ„ÙØ© --- */
        .screen {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            background: radial-gradient(circle, rgba(0, 0, 0, 0.8) 0%, rgba(0, 0, 0, 0.95) 100%);
            backdrop-filter: blur(5px);
            z-index: 100;
            transition: opacity 0.5s;
            padding: 20px;
            box-sizing: border-box;
        }
        .screen.hidden { opacity: 0; pointer-events: none; }
        .screen h1 { font-size: 52px; font-weight: 900; margin-bottom: 10px; color: #fff; text-shadow: 0 0 10px #00bfff, 0 0 20px #00bfff; }
        .screen h2 { font-size: 36px; margin-bottom: 30px; color: #eee; font-weight: 700; }
        .screen p { font-size: 20px; max-width: 600px; line-height: 1.7; }
        .screen button {
            font-family: 'Cairo', sans-serif;
            font-size: 22px;
            font-weight: 700;
            padding: 15px 40px;
            margin-top: 30px;
            cursor: pointer;
            background-image: linear-gradient(45deg, #00bfff, #007bff);
            border: none;
            color: #fff;
            border-radius: 50px;
            transition: transform 0.2s ease-out, box-shadow 0.2s ease-out;
            box-shadow: 0 4px 15px rgba(0, 123, 255, 0.4);
        }
        .screen button:hover { transform: scale(1.05); box-shadow: 0 6px 20px rgba(0, 123, 255, 0.6); }
        .author { color: #aaa; margin-top: 5px; font-size: 18px !important; }
        .credits { margin-top: 40px; color: #888; font-size: 16px; }
        
        /* --- Ø´Ø§Ø´Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø© --- */
        #options-container { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; width: 100%; max-width: 600px; }
        .option-btn { font-size: 20px; padding: 20px; margin: 0 !important; background-color: #34495e; color: #ecf0f1; border: 2px solid #7f8c8d; border-radius: 10px; direction: ltr; }
        .option-btn:hover { background-color: #4a627a; border-color: #00bfff; }
        .option-btn.correct { background-image: linear-gradient(45deg, #27ae60, #2ecc71) !important; border-color: #2ecc71; }
        .option-btn.incorrect { background-image: linear-gradient(45deg, #c0392b, #e74c3c) !important; border-color: #e74c3c; }
        #kc-feedback { margin-top: 20px; font-size: 22px; height: 30px; }

        #message { position: absolute; top: 20px; width: 90%; left: 5%; text-align: center; font-size: 20px; color: #fff; background-color: rgba(0, 0, 0, 0.7); padding: 10px 0; z-index: 50; transition: color 0.3s; border-radius: 10px; }

        /* --- ØªØ­Ø¯ÙŠ Ø§Ù„Ø¹Ø±Ø¨Ø© --- */
        #challenge-cart-screen { background-color: #2c3e50; backdrop-filter: none; }
        #track { position: absolute; bottom: 150px; left: 5%; width: 90%; height: 10px; background-color: #7f8c8d; border-radius: 5px; }
        #cart { position: absolute; width: 80px; height: 50px; background-image: linear-gradient(to top, #c0392b, #e74c3c); bottom: 160px; border-radius: 5px; box-sizing: border-box; border: 2px solid #c0392b; z-index: 10; }
        #cart.inactive { cursor: pointer !important; border-color: #f1c40f; box-shadow: 0 0 15px #f1c40f; animation: pulse-yellow 2s infinite; }
        #wall { position: absolute; width: 20px; height: 150px; background-color: rgba(173, 216, 230, 0.5); border: 2px solid #add8e6; bottom: 160px; right: 50px; transition: all 0.2s; }
        #force-indicator { position: absolute; height: 20px; bottom: 185px; background: linear-gradient(to right, rgba(255, 200, 0, 0.8), rgba(255, 100, 0, 0.9)); border-radius: 10px; box-shadow: 0 0 15px rgba(255, 150, 0, 0.7); transition: width 0.1s linear; z-index: 9; }
        #mouse-cursor { position: absolute; width: 20px; height: 20px; border: 2px solid #00bfff; border-radius: 50%; transform: translate(-50%, -50%); pointer-events: none; z-index: 200; backdrop-filter: invert(1); }
        @keyframes pulse-yellow { 0% { box-shadow: 0 0 15px #f1c40f; } 50% { box-shadow: 0 0 25px #f1c40f; } 100% { box-shadow: 0 0 15px #f1c40f; } }

        /* --- ØªØ­Ø¯ÙŠ Ø­ÙØ¸ Ø§Ù„Ø·Ø§Ù‚Ø© (Ø§Ù„Ø¨Ù†Ø¯ÙˆÙ„) --- */
        #challenge-energy-screen { background-color: #1d2c4d; backdrop-filter: none; }
        #pendulum-container { position: relative; width: 300px; height: 400px; }
        #pivot { position: absolute; top: 0; left: 50%; width: 20px; height: 20px; background: #7f8c8d; border-radius: 50%; transform: translateX(-50%); }
        #pendulum-arm { position: absolute; top: 10px; left: 50%; width: 4px; height: 200px; background: #bdc3c7; transform-origin: top center; }
        #pendulum-bob { position: absolute; bottom: -25px; left: 50%; transform: translateX(-50%); width: 50px; height: 50px; background: #f1c40f; border-radius: 50%; }
        #pendulum-arm.swing { animation: swing 4s ease-in-out infinite; }
        @keyframes swing { 0% { transform: rotate(-45deg); } 50% { transform: rotate(45deg); } 100% { transform: rotate(-45deg); } }
        #energy-question-box { position: absolute; top: 60%; width: 100%; background: rgba(0,0,0,0.7); padding: 20px; border-radius: 10px; display: none; }
        #energy-question-box p { margin: 0 0 20px 0; font-size: 22px; }
        #energy-question-box .choices { display: flex; justify-content: space-around; }
        
        /* --- ØªØ­Ø¯ÙŠ Ø§Ù„Ø¬Ø§Ø°Ø¨ÙŠØ© Ø§Ù„Ù…Ø¯Ø§Ø±ÙŠØ© --- */
        #challenge-gravity-orbit-screen { background: #0c0c1e url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100"><circle fill="white" cx="10" cy="10" r="1"/><circle fill="white" cx="50" cy="80" r="1"/><circle fill="white" cx="90" cy="30" r="1"/><circle fill="white" cx="30" cy="50" r="1"/></svg>'); backdrop-filter: none; }
        #orbit-scene { position: relative; width: 500px; height: 500px; }
        #sun { position: absolute; top: 50%; left: 50%; width: 80px; height: 80px; background: #f1c40f; border-radius: 50%; transform: translate(-50%,-50%); box-shadow: 0 0 40px #f39c12; }
        #planet-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
        #planet { position: absolute; top: 50%; left: 20px; width: 30px; height: 30px; background: #3498db; border-radius: 50%; transform: translateY(-50%); }
        #orbit-controls { display: flex; flex-direction: column; align-items: center; width: 80%; max-width: 600px; margin-top: 20px; }
        #speed-choices { display: flex; gap: 10px; margin-bottom: 20px; }
        #speed-choices button { margin: 0; padding: 10px 20px; font-size: 18px; }
        #speed-choices button.active { border: 3px solid #f1c40f; box-shadow: 0 0 10px #f1c40f; }
        #planet-container.success { animation: orbit-success 4s linear infinite; }
        #planet-container.crash { animation: orbit-crash 2s ease-in forwards; }
        #planet-container.escape { animation: orbit-escape 2s ease-out forwards; }
        @keyframes orbit-success { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        @keyframes orbit-crash { from { transform: rotate(0deg) scale(1); } to { transform: rotate(180deg) scale(0); } }
        @keyframes orbit-escape { from { transform: scale(1) translate(0, 0); } to { transform: scale(1.5) translate(400px, -200px); opacity: 0; } }

        /* --- ØªØ­Ø¯ÙŠ Ø³Ø±Ø¹Ø© Ø§Ù„Ø¶ÙˆØ¡ --- */
        #challenge-light-screen { background-color: #000; justify-content: space-between; backdrop-filter: none; }
        #celestial-bodies { position: relative; width: 100%; height: 200px; margin: 20px 0; }
        #earth, #mars { position: absolute; top: 50%; transform: translateY(-50%); font-size: 80px; }
        #earth { left: 50px; } #mars { right: 50px; }
        #rocket, #light-beam { position: absolute; top: 50%; left: 140px; transform: translateY(-50%); }
        #rocket { font-size: 40px; } #light-beam { width: 0; height: 5px; background: white; box-shadow: 0 0 15px white; }
        #light-choices { display: flex; gap: 20px; }
        @keyframes travel-rocket { from { left: 140px; } to { left: 620px; } }
        @keyframes travel-light { from { width: 0; } to { width: 480px; } }
        
        /* --- ØªØ­Ø¯ÙŠ Ø§Ù„Ù…Ù‚Ø§ÙˆÙ…Ø© --- */
        #challenge-resistance-screen { background-color: #2c2c3e; justify-content: space-evenly; backdrop-filter: none; }
        #dim-circuit { display: flex; align-items: center; justify-content: center; gap: 20px; margin-bottom: 20px; }
        #dimmable-bulb { font-size: 100px; transition: color 0.3s, text-shadow 0.3s; }
        .circuit-symbol { font-size: 80px; }
        #resistance-controls { width: 80%; max-width: 500px; }
        .slider-group { margin: 25px 0; }
        .slider-group label { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; font-size: 20px; }
        .slider-group input { width: 100%; }

        /* --- ØªØ­Ø¯ÙŠ Ù‚Ø§Ù†ÙˆÙ† Ø£ÙˆÙ… --- */
        #challenge-ohm-screen { background-color: #1a1a2e; justify-content: flex-start; padding-top: 50px; overflow-y: auto; backdrop-filter: none; }
        #circuit-board { width: 80%; }
        #microchip { font-size: 100px; transition: text-shadow 0.3s, color 0.3s; color: #555; }
        #ohm-controls { width: 80%; max-width: 500px; padding-bottom: 50px; }
        #current-display { font-size: 24px; margin-top: 20px; color: #e0e0e0; height: 30px; font-weight: bold; }
        
        /* --- ØªØ­Ø¯ÙŠ Ø§Ù„ØªØ±Ø¯Ø¯ --- */
        #challenge-frequency-screen { background-color: #0d0d1a; justify-content: space-evenly; backdrop-filter: none; }
        .wave-canvas { background-color: #000; border: 1px solid #333; }
        #freq-controls { width: 80%; max-width: 500px; }
    </style>
</head>
<body>

    <div id="game-container">
        <!-- Ù…Ø¤Ø´Ø± Ø§Ù„ÙØ£Ø±Ø© Ø§Ù„Ù…Ø®ØµØµ -->
        <div id="mouse-cursor" class="hidden"></div>
        
        <!-- Ø§Ù„Ø´Ø§Ø´Ø§Øª -->
        <div id="intro-screen" class="screen"><h1>Ù…Ø®ØªØ¨Ø± Ø§Ù„ØªØ­Ø¯ÙŠ Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¦ÙŠ</h1><p class="author">Ø¥Ø¹Ø¯Ø§Ø¯: Ù†ÙˆØ±Ù‡ Ø§Ù„Ø³Ø¨ÙŠØ¹ÙŠ</p><p>Ø£ÙƒÙ…Ù„ ÙƒÙ„ ØªØ­Ø¯Ù Ø¹Ù…Ù„ÙŠØŒ Ø«Ù… Ø£Ø¬Ø¨ Ø¹Ù† Ø³Ø¤Ø§Ù„ Ù†Ø¸Ø±ÙŠ Ù„ØªØ«Ø¨Øª ÙÙ‡Ù…Ùƒ ÙˆØªÙ†ØªÙ‚Ù„ Ù„Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©.</p><button id="start-btn">Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ­Ø¯ÙŠ</button></div>
        <div id="knowledge-check-screen" class="screen hidden"><h2 id="kc-question"></h2><div id="options-container"></div><p id="kc-feedback"></p></div>
        <div id="transition-screen" class="screen hidden"><h2>Ø£Ø­Ø³Ù†Øª!</h2><p id="transition-message"></p><button id="continue-btn">Ø§Ù†ØªÙ‚Ù„ Ù„Ù„ØªØ­Ø¯ÙŠ Ø§Ù„ØªØ§Ù„ÙŠ</button></div>
        <div id="challenge-cart-screen" class="screen hidden"><div id="track"></div><div id="cart"></div><div id="wall"></div><div id="force-indicator"></div><div id="message"></div></div>
        <div id="challenge-energy-screen" class="screen hidden"><h2>ØªØ­Ø¯ÙŠ Ø­ÙØ¸ Ø§Ù„Ø·Ø§Ù‚Ø©</h2><div id="pendulum-container"><div id="pivot"></div><div id="pendulum-arm"><div id="pendulum-bob"></div></div></div><button id="start-pendulum-btn">Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ£Ø±Ø¬Ø­</button><div id="energy-question-box"><p>ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ù„Ø­Ø¸Ø©ØŒ Ø£ÙŠ Ø·Ø§Ù‚Ø© ØªÙƒÙˆÙ† ÙÙŠ Ø£Ù‚ØµÙ‰ Ù‚ÙŠÙ…Ø© Ù„Ù‡Ø§ØŸ</p><div class="choices"><button id="potential-btn">Ø§Ù„Ø·Ø§Ù‚Ø© Ø§Ù„ÙƒØ§Ù…Ù†Ø©</button><button id="kinetic-btn">Ø§Ù„Ø·Ø§Ù‚Ø© Ø§Ù„Ø­Ø±ÙƒÙŠØ©</button></div></div><div id="message"></div></div>
        <div id="challenge-gravity-orbit-screen" class="screen hidden"><h2>ØªØ­Ø¯ÙŠ Ø§Ù„Ø³Ø±Ø¹Ø© Ø§Ù„Ù…Ø¯Ø§Ø±ÙŠØ©</h2><p>Ø§Ø®ØªØ± Ø§Ù„Ø³Ø±Ø¹Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© Ø§Ù„ØµØ­ÙŠØ­Ø© Ù„ÙˆØ¶Ø¹ Ø§Ù„ÙƒÙˆÙƒØ¨ ÙÙŠ Ù…Ø¯Ø§Ø± Ù…Ø³ØªÙ‚Ø±.</p><div id="orbit-scene"><div id="sun"></div><div id="planet-container"><div id="planet"></div></div></div><div id="orbit-controls"><div id="speed-choices"><button data-speed="0">0</button><button data-speed="30">30</button><button data-speed="50">50</button><button data-speed="80">80</button><button data-speed="100">100</button></div><button id="launch-planet-btn">Ø£Ø·Ù„Ù‚ Ø§Ù„ÙƒÙˆÙƒØ¨!</button></div><div id="message"></div></div>
        <div id="challenge-light-screen" class="screen hidden"><div id="light-scenario"><h2>ØªØ­Ø¯ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„Ø§Øª Ø§Ù„ÙØ¶Ø§Ø¦ÙŠØ©</h2><p>Ø£Ø±Ø³Ù„ Ø±Ø³Ø§Ù„Ø© Ø¹Ø§Ø¬Ù„Ø© Ù…Ù† Ø§Ù„Ø£Ø±Ø¶ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø±ÙŠØ®. Ø§Ø®ØªØ± Ø£Ø³Ø±Ø¹ ÙˆØ³ÙŠÙ„Ø©!</p></div><div id="celestial-bodies"><div id="earth">ğŸŒ</div><div id="rocket" class="hidden">ğŸš€</div><div id="light-beam" class="hidden"></div><div id="mars">ğŸ›°ï¸</div></div><div id="light-choices"><button data-choice="sound">Ù…ÙˆØ¬Ø© ØµÙˆØªÙŠØ©</button><button data-choice="rocket">ØµØ§Ø±ÙˆØ® ÙØ§Ø¦Ù‚ Ø§Ù„Ø³Ø±Ø¹Ø©</button><button data-choice="light">Ù†Ø¨Ø¶Ø© Ø¶ÙˆØ¦ÙŠØ©</button></div><div id="message"></div></div>
        <div id="challenge-resistance-screen" class="screen hidden"><h2>ØªØ­Ø¯ÙŠ Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ø³Ø·ÙˆØ¹</h2><p>Ø§Ø¶Ø¨Ø· Ø§Ù„Ù…Ù‚Ø§ÙˆÙ…Ø© Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø³Ø·ÙˆØ¹ Ù…Ø±ÙŠØ­ ÙˆØ¢Ù…Ù†.</p><div id="dim-circuit"><span class="circuit-symbol">ğŸ”‹</span><div id="dimmable-bulb">ğŸ’¡</div></div><div id="resistance-controls"><div class="slider-group"><label>Ø§Ù„Ù…Ù‚Ø§ÙˆÙ…Ø©: <span id="dim-resistance-value">5</span> Î©</label><input type="range" id="dim-resistance-slider" min="1" max="10" value="5" step="0.5"></div></div><div id="message"></div></div>
        <div id="challenge-ohm-screen" class="screen hidden"><div id="circuit-board"><h2>ØªØ­Ø¯ÙŠ Ø§Ù„Ø¯Ø§Ø¦Ø±Ø© Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ©</h2><div id="microchip">ğŸ’¡</div><p>Ø´ØºÙ„ Ø§Ù„Ù…ØµØ¨Ø§Ø­ Ø¨Ø£Ù…Ø§Ù†. Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø¢Ù…Ù† Ù„Ù„ØªÙŠØ§Ø±: 2.0 - 3.0 Ø£Ù…Ø¨ÙŠØ±</p><div id="current-display">Ø§Ù„ØªÙŠØ§Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ: 0.00 Ø£Ù…Ø¨ÙŠØ±</div></div><div id="ohm-controls"><div class="slider-group"><label>Ø§Ù„Ø¬Ù‡Ø¯ (ÙÙˆÙ„Øª): <span id="voltage-value">10</span>V</label><input type="range" id="voltage-slider" min="1" max="20" value="10"></div><div class="slider-group"><label>Ø§Ù„Ù…Ù‚Ø§ÙˆÙ…Ø© (Ø£ÙˆÙ…): <span id="resistance-value">2</span>Î©</label><input type="range" id="resistance-slider" min="1" max="10" value="2"></div></div><div id="message"></div></div>
        <div id="challenge-frequency-screen" class="screen hidden"><h2>ØªØ­Ø¯ÙŠ Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø¥Ø´Ø§Ø±Ø©</h2><p>Ø·Ø§Ø¨Ù‚ ØªØ±Ø¯Ø¯ Ù…ÙˆØ¬ØªÙƒ Ù…Ø¹ Ø§Ù„Ø¥Ø´Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ©.</p><canvas id="target-wave-canvas" class="wave-canvas" width="600" height="100"></canvas><canvas id="user-wave-canvas" class="wave-canvas" width="600" height="100"></canvas><div id="freq-controls"><div class="slider-group"><label>Ø§Ù„ØªØ±Ø¯Ø¯: <span id="freq-value">5</span> Hz</label><input type="range" id="freq-slider" min="1" max="10" value="5" step="0.1"></div></div><div id="message"></div></div>
        <div id="end-screen" class="screen hidden"><h1>Ø£Ø­Ø³Ù†Øª ØµÙ†Ø¹Ø§Ù‹!</h1><p>Ù„Ù‚Ø¯ Ø£Ø«Ø¨ØªØª ÙÙ‡Ù…Ùƒ Ù„Ù…ÙØ§Ù‡ÙŠÙ… Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¡ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©!</p><div class="credits"><p>Ø¥Ø¹Ø¯Ø§Ø¯ ÙˆØªÙ‚Ø¯ÙŠÙ…: Ù†ÙˆØ±Ù‡ Ø§Ù„Ø³Ø¨ÙŠØ¹ÙŠ</p><p>ØªÙ… Ø§Ù„ØªØ·ÙˆÙŠØ± Ø¨Ù…Ø³Ø§Ø¹Ø¯Ø©: Gemini AI</p></div><button id="restart-btn">Ø§Ù„Ø¹Ø¨ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰</button></div>
    </div>

    <script>
        const introScreen = document.getElementById('intro-screen'), endScreen = document.getElementById('end-screen'),
              knowledgeCheckScreen = document.getElementById('knowledge-check-screen'),
              transitionScreen = document.getElementById('transition-screen'),
              startBtn = document.getElementById('start-btn'), restartBtn = document.getElementById('restart-btn'),
              continueBtn = document.getElementById('continue-btn'),
              challengeCartScreen = document.getElementById('challenge-cart-screen'),
              challengeEnergyScreen = document.getElementById('challenge-energy-screen'),
              challengeGravityOrbitScreen = document.getElementById('challenge-gravity-orbit-screen'),
              challengeLightScreen = document.getElementById('challenge-light-screen'),
              challengeResistanceScreen = document.getElementById('challenge-resistance-screen'),
              challengeOhmScreen = document.getElementById('challenge-ohm-screen'),
              challengeFrequencyScreen = document.getElementById('challenge-frequency-screen');

        const kcQuestion = document.getElementById('kc-question'), kcOptionsContainer = document.getElementById('options-container'), kcFeedback = document.getElementById('kc-feedback');
        
        let activeChallenge = 0, gameLoopId, nextChallengeAction;

        const knowledgeChecks = [
            { question: "Ù…Ø§ Ù‡ÙŠ ÙˆØ­Ø¯Ø© Ù‚ÙŠØ§Ø³ Ø§Ù„Ù‚ÙˆØ© ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø¯ÙˆÙ„ÙŠ (SI)ØŸ", options: ["Ø§Ù„Ø¬ÙˆÙ„ (Joule)", "Ø§Ù„ÙˆØ§Ø· (Watt)", "Ø§Ù„Ù†ÙŠÙˆØªÙ† (Newton)", "Ø§Ù„ÙƒÙŠÙ„ÙˆØ¬Ø±Ø§Ù… (Kilogram)"], correctAnswerIndex: 2, nextAction: () => showTransitionScreen("Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©: ØªØ­Ø¯ÙŠ Ø§Ù„Ø·Ø§Ù‚Ø© Ø§Ù„Ø­Ø±ÙƒÙŠØ©!", () => setupCartChallenge(2)) },
            { question: "Ù…Ø§ Ù‡ÙŠ ÙˆØ­Ø¯Ø© Ù‚ÙŠØ§Ø³ Ø§Ù„Ø·Ø§Ù‚Ø©ØŸ", options: ["Ø§Ù„Ø£ÙˆÙ… (Ohm)", "Ø§Ù„Ø¬ÙˆÙ„ (Joule)", "Ø§Ù„ÙÙˆÙ„Øª (Volt)", "Ø§Ù„Ù†ÙŠÙˆØªÙ† (Newton)"], correctAnswerIndex: 1, nextAction: () => showTransitionScreen("Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©: ØªØ­Ø¯ÙŠ Ø­ÙØ¸ Ø§Ù„Ø·Ø§Ù‚Ø©!", setupEnergyChallenge) },
            { question: "Ù…Ø§ Ù‡Ùˆ Ù‚Ø§Ù†ÙˆÙ† Ø­ÙØ¸ Ø§Ù„Ø·Ø§Ù‚Ø©ØŸ", options: ["Ø§Ù„Ø·Ø§Ù‚Ø© ØªØ²ÙŠØ¯ ÙÙŠ Ø§Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ù…ØºÙ„Ù‚Ø©", "Ø§Ù„Ø·Ø§Ù‚Ø© ØªÙÙ†Ù‰ Ø¹Ù†Ø¯ Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡Ø§", "Ø§Ù„Ø·Ø§Ù‚Ø© Ù„Ø§ ØªÙÙ†Ù‰ ÙˆÙ„Ø§ ØªØ³ØªØ­Ø¯Ø« Ù…Ù† Ø¹Ø¯Ù…", "Ø§Ù„Ø·Ø§Ù‚Ø© ØªØªÙ†Ø§Ø³Ø¨ Ø·Ø±Ø¯ÙŠØ§Ù‹ Ù…Ø¹ Ø§Ù„ÙƒØªÙ„Ø©"], correctAnswerIndex: 2, nextAction: () => showTransitionScreen("Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©: ØªØ­Ø¯ÙŠ Ø§Ù„Ø¬Ø§Ø°Ø¨ÙŠØ©!", setupGravityOrbitChallenge) },
            { question: "Ù…Ø§ Ù‡Ùˆ Ù‚Ø§Ù†ÙˆÙ† Ø§Ù„Ø¬Ø§Ø°Ø¨ÙŠØ© Ø§Ù„Ø¹Ø§Ù… Ù„Ù†ÙŠÙˆØªÙ†ØŸ", options: ["F = G &middot; (m<sub>1</sub>m<sub>2</sub>) / r<sup>2</sup>", "F = G &middot; (m<sub>1</sub> + m<sub>2</sub>) / r<sup>2</sup>", "F = G &middot; (m<sub>1</sub>m<sub>2</sub>) &middot; r<sup>2</sup>", "F = G &middot; r<sup>2</sup> / (m<sub>1</sub>m<sub>2</sub>)"], correctAnswerIndex: 0, nextAction: () => showTransitionScreen("Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©: ØªØ­Ø¯ÙŠ Ø³Ø±Ø¹Ø© Ø§Ù„Ø¶ÙˆØ¡!", setupLightChallenge) },
            { question: "Ù…Ø§ Ù‡ÙŠ Ø³Ø±Ø¹Ø© Ø§Ù„Ø¶ÙˆØ¡ ÙÙŠ Ø§Ù„ÙØ±Ø§Øº (ØªÙ‚Ø±ÙŠØ¨Ø§Ù‹)ØŸ", options: ["340 Ù…/Ø«", "3000 ÙƒÙ…/Ø³Ø§Ø¹Ø©", "300 Ù…Ù„ÙŠÙˆÙ† Ù…/Ø«", "100 Ø£Ù„Ù ÙƒÙ…/Ø«"], correctAnswerIndex: 2, nextAction: () => showTransitionScreen("Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©: ØªØ­Ø¯ÙŠ Ø§Ù„Ù…Ù‚Ø§ÙˆÙ…Ø©!", setupResistanceChallenge) },
            { question: "Ù…Ø§ Ù‡ÙŠ ÙˆØ­Ø¯Ø© Ù‚ÙŠØ§Ø³ Ø§Ù„Ù…Ù‚Ø§ÙˆÙ…Ø© Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ©ØŸ", options: ["Ø§Ù„Ø£Ù…Ø¨ÙŠØ± (Ampere)", "Ø§Ù„ÙˆØ§Ø· (Watt)", "Ø§Ù„Ø£ÙˆÙ… (Ohm)", "Ø§Ù„ÙÙˆÙ„Øª (Volt)"], correctAnswerIndex: 2, nextAction: () => showTransitionScreen("Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©: ØªØ­Ø¯ÙŠ Ù‚Ø§Ù†ÙˆÙ† Ø£ÙˆÙ…!", setupOhmChallenge) },
            { question: "Ù…Ø§ Ù‡Ùˆ Ù‚Ø§Ù†ÙˆÙ† Ø£ÙˆÙ…ØŸ", options: ["V = IR", "P = VI", "E = hf", "F = ma"], correctAnswerIndex: 1, nextAction: () => showTransitionScreen("Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø£Ø®ÙŠØ±Ø©: ØªØ­Ø¯ÙŠ Ø§Ù„ØªØ±Ø¯Ø¯!", setupFrequencyChallenge) },
            { question: "Ù…Ø§ Ù‡ÙŠ ÙˆØ­Ø¯Ø© Ù‚ÙŠØ§Ø³ Ø§Ù„ØªØ±Ø¯Ø¯ØŸ", options: ["Ø§Ù„ÙØ§Ø±Ø§Ø¯ (Farad)", "Ø§Ù„Ù‡Ø±ØªØ² (Hertz)", "Ø§Ù„Ø¯ÙŠØ³ÙŠØ¨Ù„ (Decibel)", "Ø§Ù„ÙÙˆÙ„Øª (Volt)"], correctAnswerIndex: 1, nextAction: () => showScreen(endScreen) }
        ];

        function showScreen(screen) { document.querySelectorAll('.screen').forEach(s => s.classList.add('hidden')); screen.classList.remove('hidden'); }
        function showTransitionScreen(message, nextAction) { document.getElementById('transition-message').textContent = message; nextChallengeAction = nextAction; showScreen(transitionScreen); }
        function showKnowledgeCheck(checkIndex) { const checkData = knowledgeChecks[checkIndex]; kcQuestion.textContent = checkData.question; kcOptionsContainer.innerHTML = ''; kcFeedback.textContent = ''; const optionsWithIndices = checkData.options.map((text, index) => ({ text, originalIndex: index })); for (let i = optionsWithIndices.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [optionsWithIndices[i], optionsWithIndices[j]] = [optionsWithIndices[j], optionsWithIndices[i]]; } optionsWithIndices.forEach(option => { const button = document.createElement('button'); button.innerHTML = option.text; button.classList.add('option-btn'); button.onclick = () => handleAnswer(button, option.originalIndex, checkData.correctAnswerIndex, checkData.nextAction); kcOptionsContainer.appendChild(button); }); showScreen(knowledgeCheckScreen); }
        function handleAnswer(button, selectedIndex, correctIndex, nextAction) { if (selectedIndex === correctIndex) { button.classList.add('correct'); kcFeedback.textContent = 'Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©!'; kcFeedback.style.color = '#2ecc71'; document.querySelectorAll('.option-btn').forEach(btn => btn.disabled = true); setTimeout(() => nextAction(), 1500); } else { button.classList.add('incorrect'); kcFeedback.textContent = 'Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰...'; kcFeedback.style.color = '#e74c3c'; button.disabled = true; } }
        
        const cart = document.getElementById('cart'), wall = document.getElementById('wall'), cartMessageEl = document.querySelector('#challenge-cart-screen #message'), forceIndicator = document.getElementById('force-indicator');
        let cartState = {}; const FRICTION = 0.995; let cartChallengeOver = false, wallBreakSpeed, appliedForce = 0, cartIsActive = false;
        function setupCartChallenge(part) { activeChallenge = part; cartChallengeOver = false; cartIsActive = false; cartState = { x: 50, vx: 0 }; appliedForce = 0; cart.classList.add('inactive'); cart.style.left = '50px'; wall.style.backgroundColor = 'rgba(173, 216, 230, 0.5)'; wall.style.boxShadow = 'none'; if (part === 1) { cartMessageEl.textContent = 'Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ø±Ø¨Ø© Ù„ØªÙØ¹ÙŠÙ„Ù‡Ø§ØŒ Ø«Ù… Ø­Ø±Ùƒ Ø§Ù„ÙØ£Ø±Ø© Ø£Ù…Ø§Ù…Ù‡Ø§ Ù„Ø¯ÙØ¹Ù‡Ø§.'; wallBreakSpeed = 2.0; wall.style.borderWidth = '2px'; } else if (part === 2) { cartMessageEl.textContent = 'Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ø±Ø¨Ø© Ù„ØªÙØ¹ÙŠÙ„Ù‡Ø§. Ø§Ù„Ø­Ø§Ø¦Ø· Ø£Ù‚ÙˆÙ‰ Ø§Ù„Ø¢Ù†ØŒ Ø§ÙƒØ³Ø±Ù‡!'; wallBreakSpeed = 4.0; wall.style.borderWidth = '6px'; } cartMessageEl.style.color = '#fff'; updateCartChallenge(); showScreen(challengeCartScreen); }
        function updateCartChallenge() { if (cartChallengeOver || !cartIsActive) return; const acceleration = appliedForce; cartState.vx += acceleration; cartState.vx *= FRICTION; cartState.x += cartState.vx; if (cartState.x < 50) { cartState.x = 50; cartState.vx = 0; } cart.style.left = cartState.x + 'px'; forceIndicator.style.right = (800 - cartState.x) + 'px'; const wallPosition = wall.offsetLeft; if (cartState.x + cart.offsetWidth > wallPosition) { cartState.x = wallPosition - cart.offsetWidth; if (activeChallenge === 1) { if (cartState.vx > wallBreakSpeed) loseChallenge(1); else winChallenge(1); } else if (activeChallenge === 2) { if (cartState.vx > wallBreakSpeed) winChallenge(2); else loseChallenge(2); } } }
        cart.addEventListener('click', () => { if (!cartChallengeOver) { cartIsActive = true; cart.classList.remove('inactive'); cartMessageEl.textContent = 'Ù…Ù…ØªØ§Ø²! Ø§Ù„Ø¢Ù† Ø­Ø±Ùƒ Ø§Ù„ÙØ£Ø±Ø© Ø£Ù…Ø§Ù…Ù‡Ø§.'; } });
        challengeCartScreen.addEventListener('mousemove', (e) => { if (cartChallengeOver || !cartIsActive) return; const rect = challengeCartScreen.getBoundingClientRect(); const mouseX = e.clientX - rect.left; const cartFront = cartState.x + cart.offsetWidth; if (mouseX > cartFront) { const distance = mouseX - cartFront; appliedForce = Math.min(distance / 500, 0.1); forceIndicator.style.width = Math.min(distance, 150) + 'px'; } else { appliedForce = 0; forceIndicator.style.width = '0px'; } });
        challengeCartScreen.addEventListener('mouseleave', () => { appliedForce = 0; forceIndicator.style.width = '0px'; });
        
        const pendulumArm = document.getElementById('pendulum-arm'), startPendulumBtn = document.getElementById('start-pendulum-btn'), energyQuestionBox = document.getElementById('energy-question-box'), energyMessageEl = document.querySelector('#challenge-energy-screen #message');
        let energyChallengeState = {};
        function setupEnergyChallenge() { activeChallenge = 3; energyChallengeState = { answeredPotential: false, answeredKinetic: false }; pendulumArm.classList.remove('swing'); pendulumArm.style.animationPlayState = 'paused'; energyQuestionBox.style.display = 'none'; startPendulumBtn.style.display = 'block'; energyMessageEl.textContent = ''; showScreen(challengeEnergyScreen); }
        startPendulumBtn.addEventListener('click', () => { startPendulumBtn.style.display = 'none'; pendulumArm.classList.add('swing'); pendulumArm.style.animationPlayState = 'running'; setTimeout(() => askEnergyQuestion('potential'), 1000); });
        function askEnergyQuestion(type) { pendulumArm.style.animationPlayState = 'paused'; energyQuestionBox.style.display = 'block'; energyChallengeState.currentQuestion = type; document.querySelectorAll('#energy-question-box button').forEach(b => b.disabled = false); }
        document.getElementById('potential-btn').addEventListener('click', () => handleEnergyAnswer('potential')); document.getElementById('kinetic-btn').addEventListener('click', () => handleEnergyAnswer('kinetic'));
        function handleEnergyAnswer(answer) { if (answer === energyChallengeState.currentQuestion) { energyChallengeState[`answered${answer.charAt(0).toUpperCase() + answer.slice(1)}`] = true; energyQuestionBox.style.display = 'none'; pendulumArm.style.animationPlayState = 'running'; if (energyChallengeState.answeredPotential && energyChallengeState.answeredKinetic) { winChallenge(3); } else if (energyChallengeState.answeredPotential) { setTimeout(() => askEnergyQuestion('kinetic'), 1000); } } else { energyMessageEl.textContent = 'Ø¥Ø¬Ø§Ø¨Ø© ØºÙŠØ± ØµØ­ÙŠØ­Ø©ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰!'; setTimeout(() => energyMessageEl.textContent = '', 1500); } }
        
        const planetContainer = document.getElementById('planet-container'), speedChoices = document.getElementById('speed-choices'), launchPlanetBtn = document.getElementById('launch-planet-btn'), gravityOrbitMessageEl = document.querySelector('#challenge-gravity-orbit-screen #message');
        let gravityOrbitState = {}; const CORRECT_SPEED = 80;
        function setupGravityOrbitChallenge() { activeChallenge = 4; gravityOrbitState = { selectedSpeed: null }; launchPlanetBtn.disabled = false; document.querySelectorAll('#speed-choices button').forEach(b => { b.disabled = false; b.classList.remove('active'); }); planetContainer.className = ''; gravityOrbitMessageEl.textContent = ''; showScreen(challengeGravityOrbitScreen); }
        speedChoices.querySelectorAll('button').forEach(button => { button.addEventListener('click', (e) => { document.querySelectorAll('#speed-choices button').forEach(b => b.classList.remove('active')); e.target.classList.add('active'); gravityOrbitState.selectedSpeed = parseInt(e.target.dataset.speed); }); });
        launchPlanetBtn.addEventListener('click', () => { if (gravityOrbitState.selectedSpeed === null) { gravityOrbitMessageEl.textContent = 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø³Ø±Ø¹Ø© Ø£ÙˆÙ„Ø§Ù‹!'; return; } document.querySelectorAll('#speed-choices button').forEach(b => b.disabled = true); launchPlanetBtn.disabled = true; const speed = gravityOrbitState.selectedSpeed; if (speed === CORRECT_SPEED) { planetContainer.classList.add('success'); winChallenge(4); } else if (speed > CORRECT_SPEED) { planetContainer.classList.add('escape'); loseChallenge(4, 'Ø³Ø±Ø¹Ø© Ø¹Ø§Ù„ÙŠØ© Ø¬Ø¯Ù‹Ø§! Ù„Ù‚Ø¯ Ù‡Ø±Ø¨ Ø§Ù„ÙƒÙˆÙƒØ¨.'); } else { planetContainer.classList.add('crash'); loseChallenge(4, 'Ø³Ø±Ø¹Ø© Ø¨Ø·ÙŠØ¦Ø© Ø¬Ø¯Ù‹Ø§! ØªØ­Ø·Ù… Ø§Ù„ÙƒÙˆÙƒØ¨.'); } });
        
        const lightMessageEl = document.querySelector('#challenge-light-screen #message'), rocket = document.getElementById('rocket'), lightBeam = document.getElementById('light-beam');
        function setupLightChallenge() { activeChallenge = 5; lightMessageEl.textContent = ''; document.querySelectorAll('#light-choices button').forEach(b => b.disabled = false); rocket.classList.add('hidden'); rocket.style.animation = 'none'; lightBeam.classList.add('hidden'); lightBeam.style.animation = 'none'; showScreen(challengeLightScreen); }
        document.querySelectorAll('#light-choices button').forEach(button => { button.addEventListener('click', (e) => { const choice = e.target.dataset.choice; document.querySelectorAll('#light-choices button').forEach(b => b.disabled = true); if (choice === 'sound') { loseChallenge(5, 'ÙØ´Ù„! Ø§Ù„ØµÙˆØª Ù„Ø§ ÙŠÙ†ØªÙ‚Ù„ ÙÙŠ ÙØ±Ø§Øº Ø§Ù„ÙØ¶Ø§Ø¡.'); } else if (choice === 'rocket') { rocket.classList.remove('hidden'); rocket.style.animation = 'travel-rocket 5s linear forwards'; loseChallenge(5, 'Ø¨Ø·ÙŠØ¡ Ø¬Ø¯Ù‹Ø§...'); } else if (choice === 'light') { lightBeam.classList.remove('hidden'); lightBeam.style.animation = 'travel-light 0.2s linear forwards'; winChallenge(5); } }); });

        const dimmableBulb = document.getElementById('dimmable-bulb'), dimResistanceSlider = document.getElementById('dim-resistance-slider'), dimResistanceValue = document.getElementById('dim-resistance-value'), resistanceMessageEl = document.querySelector('#challenge-resistance-screen #message');
        let resistanceChallengeOver = false; const OPTIMAL_RESISTANCE = 6.0;
        function setupResistanceChallenge() { activeChallenge = 6; resistanceChallengeOver = false; dimResistanceSlider.value = 1; dimResistanceSlider.disabled = false; resistanceMessageEl.textContent = ''; updateResistanceChallenge(); showScreen(challengeResistanceScreen); }
        function updateResistanceChallenge() { if (resistanceChallengeOver) return; const resistance = parseFloat(dimResistanceSlider.value); dimResistanceValue.textContent = resistance.toFixed(1); const difference = Math.abs(resistance - OPTIMAL_RESISTANCE); if (difference < 0.5) { dimmableBulb.style.color = '#2ecc71'; dimmableBulb.style.textShadow = `0 0 15px #2ecc71`; winChallenge(6); } else if (resistance < OPTIMAL_RESISTANCE) { const glare = 1 - (resistance / OPTIMAL_RESISTANCE); dimmableBulb.style.color = `rgba(255, 255, 200, ${0.5 + glare * 0.5})`; dimmableBulb.style.textShadow = `0 0 ${glare * 40}px #fff`; } else { const dimness = 1 - ((resistance - OPTIMAL_RESISTANCE) / (10 - OPTIMAL_RESISTANCE)); dimmableBulb.style.color = `rgba(127, 140, 141, ${dimness * 0.8 + 0.2})`; dimmableBulb.style.textShadow = 'none'; } }
        dimResistanceSlider.addEventListener('input', updateResistanceChallenge);
        
        const microchip = document.getElementById('microchip'), currentDisplay = document.getElementById('current-display'),
              voltageSlider = document.getElementById('voltage-slider'), resistanceSlider = document.getElementById('resistance-slider'),
              voltageValueSpan = document.getElementById('voltage-value'), resistanceValueSpan = document.getElementById('resistance-value'),
              ohmMessageEl = document.querySelector('#challenge-ohm-screen #message');
        const SAFE_CURRENT_MIN = 2.0, SAFE_CURRENT_MAX = 3.0; let ohmChallengeOver = false;
        function setupOhmChallenge() { activeChallenge = 7; ohmChallengeOver = false; voltageSlider.value = 10; resistanceSlider.value = 2; voltageSlider.disabled = false; resistanceSlider.disabled = false; ohmMessageEl.textContent = ''; updateOhmChallenge(); showScreen(challengeOhmScreen); }
        function updateOhmChallenge() { if (ohmChallengeOver) return; const voltage = voltageSlider.value; const resistance = resistanceSlider.value; voltageValueSpan.textContent = voltage; resistanceValueSpan.textContent = resistance; const current = voltage / resistance; currentDisplay.textContent = `Ø§Ù„ØªÙŠØ§Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ: ${current.toFixed(2)} Ø£Ù…Ø¨ÙŠØ±`; if (current > SAFE_CURRENT_MAX) { microchip.style.color = '#e74c3c'; microchip.style.textShadow = '0 0 20px #c0392b'; } else if (current < SAFE_CURRENT_MIN) { microchip.style.color = '#7f8c8d'; microchip.style.textShadow = 'none'; } else { winChallenge(7, 'safe'); } }
        voltageSlider.addEventListener('input', updateOhmChallenge); resistanceSlider.addEventListener('input', updateOhmChallenge);

        const targetCanvas = document.getElementById('target-wave-canvas'), userCanvas = document.getElementById('user-wave-canvas'),
              freqSlider = document.getElementById('freq-slider'), freqValueSpan = document.getElementById('freq-value'),
              freqMessageEl = document.querySelector('#challenge-frequency-screen #message');
        let targetFreq, userFreq, phase = 0, freqChallengeOver = false;
        function setupFrequencyChallenge() {
            activeChallenge = 8; freqChallengeOver = false;
            const startFreq = 5.0;
            do { targetFreq = (Math.floor(Math.random() * 70) / 10 + 2).toFixed(1); } while (Math.abs(targetFreq - startFreq) < 1.5);
            freqSlider.value = startFreq;
            freqMessageEl.textContent = '';
            showScreen(challengeFrequencyScreen);
        }
        function updateFrequencyChallenge() {
            if (freqChallengeOver) return;
            userFreq = parseFloat(freqSlider.value); freqValueSpan.textContent = userFreq.toFixed(1); phase += 0.05;
            drawWave(targetCanvas, targetFreq, '#00bfff');
            let userColor; const difference = Math.abs(userFreq - targetFreq);
            if (difference < 0.2) { userColor = '#2ecc71'; winChallenge(8); }
            else if (difference < 1.0) { userColor = '#f1c40f'; }
            else { userColor = '#e74c3c'; }
            drawWave(userCanvas, userFreq, userColor);
        }
        function drawWave(canvas, freq, color) { const ctx = canvas.getContext('2d'), width = canvas.width, height = canvas.height, amp = 40; ctx.clearRect(0, 0, width, height); ctx.beginPath(); ctx.lineWidth = 3; ctx.strokeStyle = color; for (let x = 0; x < width; x++) { const y = height / 2 + amp * Math.sin((x * freq / 100) + phase); if (x === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y); } ctx.stroke(); }

        function winChallenge(part, status = '') {
            cancelAnimationFrame(gameLoopId);
            if (part === 1) { cartChallengeOver = true; cartMessageEl.textContent = 'ØªØ­ÙƒÙ… Ø¯Ù‚ÙŠÙ‚! Ù†Ø¬Ø­Øª.'; cartMessageEl.style.color = '#2ecc71'; setTimeout(() => showKnowledgeCheck(0), 1500); }
            else if (part === 2) { cartChallengeOver = true; wall.style.backgroundColor = '#27ae60'; cartMessageEl.textContent = 'Ù‚ÙˆØ© ÙƒØ§ÙÙŠØ©! Ù„Ù‚Ø¯ Ø­Ø·Ù…Øª Ø§Ù„Ø­Ø§Ø¦Ø·.'; cartMessageEl.style.color = '#2ecc71'; setTimeout(() => showKnowledgeCheck(1), 1500); }
            else if (part === 3) { pendulumArm.classList.remove('swing'); energyMessageEl.textContent = 'Ù†Ø¬Ø§Ø­! Ù„Ù‚Ø¯ ÙÙ‡Ù…Øª ØªØ­ÙˆÙ„Ø§Øª Ø§Ù„Ø·Ø§Ù‚Ø©.'; energyMessageEl.style.color = '#2ecc71'; setTimeout(() => showKnowledgeCheck(2), 2000); }
            else if (part === 4) { gravityOrbitMessageEl.textContent = 'Ù…Ø¯Ø§Ø± Ù…Ø³ØªÙ‚Ø±! Ø£Ø­Ø³Ù†Øª.'; gravityOrbitMessageEl.style.color = '#2ecc71'; setTimeout(() => showKnowledgeCheck(3), 4000); }
            else if (part === 5) { lightMessageEl.textContent = 'Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø£Ù…Ø«Ù„! Ø§Ù„Ø¶ÙˆØ¡ Ù‡Ùˆ Ø£Ø³Ø±Ø¹ Ø´ÙŠØ¡ ÙÙŠ Ø§Ù„ÙƒÙˆÙ†.'; lightMessageEl.style.color = '#2ecc71'; setTimeout(() => showKnowledgeCheck(4), 1500); }
            else if (part === 6) { resistanceChallengeOver = true; resistanceMessageEl.textContent = 'Ø³Ø·ÙˆØ¹ Ù…Ø«Ø§Ù„ÙŠ! Ù†Ø¬Ø­Øª.'; resistanceMessageEl.style.color = '#2ecc71'; setTimeout(() => showKnowledgeCheck(5), 1500); }
            else if (part === 7 && status === 'safe') { ohmChallengeOver = true; voltageSlider.disabled = true; resistanceSlider.disabled = true; microchip.style.color = '#2ecc71'; microchip.style.textShadow = '0 0 20px #27ae60'; ohmMessageEl.textContent = 'ØªØ´ØºÙŠÙ„ Ø¢Ù…Ù†! Ù„Ù‚Ø¯ Ù†Ø¬Ø­Øª.'; ohmMessageEl.style.color = '#2ecc71'; setTimeout(() => showKnowledgeCheck(6), 2000); }
            else if (part === 8) { freqChallengeOver = true; freqMessageEl.textContent = 'ØªÙ…Øª Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø¨Ù†Ø¬Ø§Ø­!'; freqMessageEl.style.color = '#2ecc71'; setTimeout(() => showKnowledgeCheck(7), 1500); }
        }

        function loseChallenge(part, customMessage = '') {
            cancelAnimationFrame(gameLoopId);
            if (part === 1) { cartChallengeOver = true; wall.style.backgroundColor = 'red'; wall.style.boxShadow = '0 0 20px red'; cartMessageEl.textContent = 'ØªØ­Ø·Ù…!'; setTimeout(() => setupCartChallenge(1), 2500); }
            else if (part === 2) { cartChallengeOver = true; cartMessageEl.textContent = 'Ù„Ù… ØªÙƒÙ† Ø§Ù„Ø³Ø±Ø¹Ø© ÙƒØ§ÙÙŠØ©!'; setTimeout(() => setupCartChallenge(2), 2500); }
            else if (part === 4) { gravityOrbitMessageEl.textContent = customMessage; gravityOrbitMessageEl.style.color = '#e74c3c'; setTimeout(setupGravityOrbitChallenge, 2000); }
            else if (part === 5) { lightMessageEl.textContent = customMessage; lightMessageEl.style.color = '#e74c3c'; setTimeout(() => setupLightChallenge(), 4000); }
            gameLoopId = requestAnimationFrame(gameLoop);
        }
        
        function gameLoop() {
            if (activeChallenge === 1 || activeChallenge === 2) updateCartChallenge();
            if (activeChallenge === 8) updateFrequencyChallenge();
            gameLoopId = requestAnimationFrame(gameLoop);
        }
        
        const mouseCursor = document.getElementById('mouse-cursor');
        document.addEventListener('mousemove', (e) => { const rect = document.getElementById('game-container').getBoundingClientRect(); mouseCursor.style.left = (e.clientX - rect.left) + 'px'; mouseCursor.style.top = (e.clientY - rect.top) + 'px'; });
        document.getElementById('game-container').addEventListener('mouseenter', () => mouseCursor.classList.remove('hidden'));
        document.getElementById('game-container').addEventListener('mouseleave', () => mouseCursor.classList.add('hidden'));

        startBtn.addEventListener('click', () => { setupCartChallenge(1); gameLoopId = requestAnimationFrame(gameLoop); });
        restartBtn.addEventListener('click', () => showScreen(introScreen));
        continueBtn.addEventListener('click', () => { if (nextChallengeAction) { cancelAnimationFrame(gameLoopId); nextChallengeAction(); gameLoopId = requestAnimationFrame(gameLoop); } });
    </script>
</body>

</html>
